<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Selection</title>
</head>
<body>

<form action="#" th:action="@{/categories}" method="get">
    <label for="category1">대분류:</label>
    <select id="category1" name="category1" onchange="updateSubcategories(this)">
        <option th:each="mainCategory : ${mainCategories}" th:value="${mainCategory}" th:text="${mainCategory}"></option>
    </select>

    <label for="category2">중분류:</label>
    <select id="category2" name="category2">
        <!-- 중분류는 JavaScript로 업데이트됩니다. -->
    </select>

    <label for="category3">소분류:</label>
    <select id="category3" name="category3">
        <!-- 소분류는 JavaScript로 업데이트됩니다. -->
    </select>
</form>

<script th:inline="javascript">
    /* 대분류 선택 시 중분류, 소분류 업데이트 */
    function updateSubcategories(selectElement) {
        var selectedCategory1 = selectElement.value;
        var category2 = document.getElementById('category2');
        var category3 = document.getElementById('category3');

        /* Thymeleaf로 부터 받은 서버 데이터를 JavaScript 변수에 할당 */
        var subcategories = /*[[${subcategoryMap}]]*/ {};

        /* 중분류 업데이트 */
        category2.innerHTML = "";
        for (var subcategory2 in subcategories[selectedCategory1]) {
            var option = document.createElement("option");
            option.value = subcategory2;
            option.textContent = subcategory2;
            category2.appendChild(option);
        }

        /* 소분류 업데이트 */
        var selectedCategory2 = category2.value;
        category3.innerHTML = "";
        for (var subcategory3 of subcategories[selectedCategory1][selectedCategory2]) {
            var option = document.createElement("option");
            option.value = subcategory3;
            option.textContent = subcategory3;
            category3.appendChild(option);
        }
    }

    /* 초기 로드 시 중분류, 소분류 설정 */
    window.onload = function() {
        updateSubcategories(document.getElementById('category1'));
    };
</script>

</body>
</html>